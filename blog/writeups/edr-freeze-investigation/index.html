<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EDR-Freeze - Forensic Analysis of an EDR Coma Attack | Tracepoint</title>
<link rel="stylesheet" href="../../../css/styles.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* Additional styles for this specific page */
.container {
  max-width: 980px;
  margin: 20px auto 60px;
  padding: 0 16px;
}
.content {
  background: var(--card-bg);
  border-radius: 12px;
  padding: 28px;
  box-shadow: 0 8px 28px rgba(0, 0, 0, 0.35);
}
h2, h3, h4 {
  text-align: center;
  margin-top: 60px;
  margin-bottom: 20px;
  position: relative;
}
h2::after, h3::after, h4::after {
  content: "";
  display: block;
  width: 60px;
  height: 2px;
  background: var(--accent-purple);
  margin: 10px auto 0;
}
h2 { font-size: 1.8em; }
h3 { font-size: 1.4em; }
h4 { font-size: 1.2em; }
p {
  line-height: 1.65;
  margin: 12px 0;
}
ul, ol {
  margin-left: 20px;
  line-height: 1.65;
}
a {
  color: var(--accent-purple);
  text-decoration: none;
  border-bottom: 1px dotted var(--accent-purple);
}
a:hover {
  color: #000;
  border-bottom-color: #000;
}
pre {
  background: #000;
  color: var(--text-primary);
  padding: 14px 16px;
  border-radius: 8px;
  overflow: auto;
  border: 1px solid var(--accent-purple-border);
  margin: 14px 0;
  font-family: "Courier New", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.9em;
}
.callout {
  border: 1px dashed var(--accent-purple-border);
  background: var(--accent-purple-light);
  padding: 14px;
  border-radius: 8px;
  margin: 18px 0;
}
code.inline-code {
  background: rgba(138, 43, 226, 0.1);
  color: #e0e0e0;
  padding: 2px 6px;
  border-radius: 3px;
  border: 1px solid rgba(138, 43, 226, 0.3);
  font-family: "Courier New", ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  font-size: 0.9em;
  font-weight: 500;
}

.callout code.inline-code {
  background: none;
  color: var(--text-secondary);
  border: none;
  padding: 0;
}

.figure {
  margin: 18px 0;
  text-align: center;
}
.figure img {
  max-width: 100%;
  height: auto;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.15);
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  cursor: zoom-in;
}
.figure figcaption {
  color: #222;
  font-size: 13px;
  margin-top: 6px;
}
table {
  width: 100%;
  border-collapse: collapse;
  margin: 12px 0;
}
th, td {
  border: 1px solid #e2e2f0;
  padding: 8px 10px;
  vertical-align: top;
}
th {
  background: #f6f5fe;
  text-align: left;
}
.meta-top {
  color: #2a2a2a;
  font-size: 14px;
  margin-bottom: 8px;
}
.badge {
  display: inline-block;
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 999px;
  color: #fff;
  background: linear-gradient(135deg, #6a11cb, #2575fc);
  margin-left: 6px;
}
.back {
  margin-bottom: 14px;
}
.back a {
  color: #fff;
  border-bottom: 1px dotted #fff;
  text-decoration: none;
}
.table-container { overflow-x: auto; }
.lightbox {
  position: fixed; inset: 0;
  background: rgba(15,15,23,.95);
  display: grid; place-items: center;
  opacity: 0; visibility: hidden;
  transition: .2s ease;
  z-index: 9999;
}
.lightbox.show { opacity: 1; visibility: visible; }
.lightbox img {
  max-width: 92vw; max-height: 90vh;
  object-fit: contain; border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0,0,0,.6);
  background: #000;
}
.lightbox .caption {
  color: #fff; margin-top: 10px; text-align: center; max-width: 92vw;
  font-size: 14px; opacity: .9;
}
.lightbox .btn {
  position: absolute; top: 50%; transform: translateY(-50%);
  background: rgba(0,0,0,.5); color: #fff; border: 1px solid var(--accent-purple-border);
  width: 42px; height: 42px; border-radius: 999px; font-size: 22px;
  display: grid; place-items: center; cursor: pointer; user-select: none;
}
.lightbox .btn:hover { background: rgba(0,0,0,.75); }
.lightbox .prev { left: 16px; }
.lightbox .next { right: 16px; }
.lightbox .close {
  top: 16px; right: 16px; transform: none; width: 38px; height: 38px; font-size: 20px;
}
</style>
</head>
<body>
<header>
<h1>Tracepoint</h1>
<nav>
<a href="../../../">Home</a>
<a href="../../../about/">About</a>
<a href="../../">Blog</a>
<a href="../../../projects/">Projects</a>
<a href="../../../certifications/">Certifications</a>
<a href="../../../contact/">Contact</a>
</nav>
</header>

<!-- Theme Toggle -->
<button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">üåô</button>
<div class="container">
<div class="back"><a href="../../">‚Üê Back to Writeups</a></div>
<div class="content">
<div class="meta-top">
<strong>EDR-Freeze - Forensic Analysis of an EDR Coma Attack</strong>
<span class="badge">DFIR</span>
<span class="badge">Memory Forensics</span>
</div>
<h5>This analysis walks through the inner workings of the EDR-Freeze technique - from thread suspension and handle manipulation to the forensic artifacts it leaves in memory - and highlights how defenders can detect and investigate such activity.</h5>
<hr>
<hr />
<p><strong>What is ‚ÄúEDR-Freeze‚Äù?</strong></p>
<p>EDR-Freeze is a proof-of-concept technique and tool (TwoSevenOneThree
/ Zero Salarium) that temporarily pauses EDR/AV processes from user mode
by abusing Windows Error Reporting (WER). Rather than relying on
Bring-Your-Own-Vulnerable-Driver (BYOVD) approaches, it leverages
legitimate Windows components (<code class="inline-code">WerFaultSecure.exe</code> +
DbgHelp‚Äôs <code class="inline-code">MiniDumpWriteDump</code>) and a timing/race condition to
suspend target threads, holding the security process in a temporary
‚Äúcoma‚Äù for a configurable interval - after which the process is resumed
cleanly. The result is a running but inert security process that
produces little or no telemetry while the attacker operates.</p>
<hr />

<h1 id="freezing-procedure">Freezing procedure</h1>
<p>In Process Explorer the process is shown as suspended, and you can
see <code class="inline-code">WerFaultSecure.exe</code> was spawned by
<code class="inline-code">EDR-Freeze_1.0.exe</code>:</p>
<figure class="figure">
<img src="./assets/Process Explorer 1.png" alt="Process Explorer 1">
<figcaption>
Process Explorer 1
</figcaption>
</figure>
<figure class="figure">
<img src="./assets/Process Explorer 2.png" alt="Process Explorer 2">
<figcaption>
Process Explorer 2
</figcaption>
</figure>
<p>Note that both <code class="inline-code">WerFaultSecure.exe</code> and
<code class="inline-code">MsMpEng.exe</code> are suspended.</p>
<h1 id="forensic-case-study-memory-image-indicators">Forensic case study
(memory image indicators)</h1>
<p>This section documents the memory artifacts you should expect when
<strong>EDR-Freeze</strong> is applied to a security process such as
<code class="inline-code">MsMpEng.exe</code> (Windows Defender). All example commands are
memory-analysis oriented and use <strong>Volatility
3</strong>/<strong>MemProcFS</strong>.</p>
<p><strong>Context:</strong> this was a controlled environment where the
only action performed was suspending <code class="inline-code">MsMpEng.exe</code>. I
intentionally skip basic enumeration plugins (<code class="inline-code">pslist</code>,
<code class="inline-code">psscan</code>, <code class="inline-code">filescan</code>) - we already know the
process exists and how the PoC was executed. Instead we focus on the
<em>underlying mechanisms and forensic signals</em> that memory
forensics uniquely reveals.</p>
<h2 id="correlated-thread-evidence---msmpeng-werfaultsecure">Correlated
thread evidence - MsMpEng ‚ÜîÔ∏é WerFaultSecure</h2>
<p></strong><strong>Our PIDs of interest are:</strong></p>
  </p>1) 3428 ‚Äì&gt; <code class="inline-code">MsMpEng.exe</code></p>
  </p>2) 10892 ‚Äì&gt; <code class="inline-code">WerFaultSecure.exe</code></p>
  </p>3) 5648 ‚Äì&gt; <code class="inline-code">EDR-Freeze_1.0</code></p>
  </p>4) 10724 ‚Äì&gt; <code class="inline-code">PowerShell.exe</code> (to some extent)</p>
<p>Starting with with enumerating suspended threads, I attempted to
utilize the <code class="inline-code">windows.suspended_threads</code> plugin for
Volatility3, but in returns an error and no results are printed so I
shifted to MemProcFS.</p>
<figure class="figure">
<img src="./assets/suspended_threads.png" alt="suspended_threads">
<figcaption>
suspended_threads
</figcaption>
</figure>
<p>For this test run (50 s suspension), we focus on the tight time
window around <strong>2025-09-26 08:35</strong>. MemProcFS shows
<code class="inline-code">MsMpEng.exe</code> (PID <strong>3428</strong>) with three
representative suspended threads (TIDs <strong>764, 4244, 7980</strong>)
created at <strong>08:35:08 ‚Üí 08:35:31</strong>. Helper process
<code class="inline-code">WerFaultSecure.exe</code> (PID <strong>10892</strong>) has
suspended threads at <strong>08:35:41</strong>, providing a temporal
association between the helper‚Äôs activity and the target freeze. The
repeated <code class="inline-code">StartAddress</code> / <code class="inline-code">Win32StartAddress</code>
values across these rows point to suspended worker threads (not
arbitrary crash stacks), which supports the conclusion that the process
was intentionally held in a suspended state during the test window.</p>
<p>Moving on to handles, I used volatility3 <code class="inline-code">windows.handles</code>
plugin to investigate the handles opened by
<code class="inline-code">WerFaultSecure.exe</code>:</p>
<pre class="command-line"><code>python3 vol.py -q -r pretty -f /mnt/c/MemoryDumps/win11defender.raw windows.handles --pid 10892 | grep 3428</code></pre>
<figure class="figure">
<img src="./assets/WerFaultSecure threads in 3428.png" alt="WerFaultSecure threads in 3428">
<figcaption>
WerFaultSecure threads in 3428
</figcaption>
</figure>
<p>The <code class="inline-code">windows.handles</code> output shows
<code class="inline-code">WerFaultSecure.exe</code> (PID 10892) opened a
<code class="inline-code">Process</code> handle to <code class="inline-code">MsMpEng.exe</code> (PID 3428) with
access mask <code class="inline-code">101450 (0x18C4A)</code> - decoded as
<code class="inline-code">PROCESS_SUSPEND_RESUME</code>, <code class="inline-code">PROCESS_CREATE_THREAD</code>,
<code class="inline-code">PROCESS_VM_OPERATION</code>, <code class="inline-code">PROCESS_DUP_HANDLE</code>, and
<code class="inline-code">PROCESS_QUERY_INFORMATION</code>. In addition, the helper holds
multiple <code class="inline-code">Thread</code> handles into the same target (granted
access <code class="inline-code">0x1FFFFF</code> / <code class="inline-code">THREAD_ALL_ACCESS</code>) for TIDs
such as <code class="inline-code">3432, 3708, 3712, 4244</code> and more. These handles and
rights form a credible mechanism for suspending/resuming the security
process‚Äô threads, which corroborates the suspended-thread artifacts seen
in the memory image.</p>
<p>While inspecting other handles opened by
<code class="inline-code">WerFaultSecure.exe</code>, I found a <code class="inline-code">File</code> handle
referencing
<code class="inline-code">\Device\HarddiskVolume3\Users\test\Desktop\EDR-Freeze_1.0\t.txt</code>.</p>
<figure class="figure">
<img src="./assets/txt file handle.png" alt="txt file handle">
<figcaption>
txt file handle
</figcaption>
</figure>
<p>I re-ran the tool to corroborate this observation with Process
Explorer; the file-related activity appears in the Process Explorer
capture.</p>
<figure class="figure">
<img src="./assets/procexp text file.png" alt="procexp text file">
<figcaption>
procexp text file
</figcaption>
</figure>
<p>Process Explorer shows <code class="inline-code">t.txt</code> being created in the current working directory,
attribute-queried, and closed within a short time span - consistent with
a temporary file</p>
<p>This behavior isn‚Äôt malicious by itself, but it‚Äôs a useful forensic
lead - preserve the file, its timestamps, and any associated file events
for later timeline and attribution work. Note:
<code class="inline-code">EDR-Freeze_1.0</code> also has the same file handle.</p>
<h2
id="wer-dbghelp-iat---static-evidence-the-helper-can-invoke-minidumps">WER
+ dbghelp IAT - static evidence the helper can invoke minidumps</h2>
<p>using the <code class="inline-code">windows.iat.IAT</code> plugin we can look at the
import tables used by a binary:</p>
<pre class="command-line"><code>python3 vol.py -q -r pretty -f /mnt/c/MemoryDumps/win11defender.raw windows.iat.IAT --pid 10892</code></pre>
<figure class="figure">
<img src="./assets/IAT by werfault.png" alt="IAT by werfault">
<figcaption>
IAT by werfault
</figcaption>
</figure>
<p>The IAT output shows <code class="inline-code">WerFaultSecure.exe</code> imports
<code class="inline-code">MiniDumpWriteDump</code> from <code class="inline-code">dbghelp.dll</code>. That
import is static proof the helper binary contains the API surface to
produce minidumps - and because <code class="inline-code">MiniDumpWriteDump</code> suspends
target threads while it runs, the presence of this import also explains
how the helper is capable of temporarily pausing another process (in our
test we used that side-effect to hold <code class="inline-code">MsMpEng.exe</code> in a
recoverable pause rather than to persist a full dump).</p>
<h2 id="investigating-command-line-arguments">Investigating command line
arguments</h2>
<p>using the <code class="inline-code">windows.cmdline</code> plugin, we can inspect the
command line arguments of our PIDs of interest and maybe glean more
information or IOCs:</p>
<pre class="command-line"><code>windows.cmdline --pid 10892 5648</code></pre>
<figure class="figure">
<img src="./assets/cmdline.png" alt="cmdline">
<figcaption>
cmdline
</figcaption>
</figure>
<p><code class="inline-code">windows.cmdline</code> shows <code class="inline-code">EDR-Freeze_1.0.exe</code>
run with <code class="inline-code">3428 50000</code> and that it spawned
<code class="inline-code">WerFaultSecure.exe</code> with the argument
<code class="inline-code">/pid 3428 /tid 3432</code>. TID <strong>3432</strong> is listed as
suspended in MsMpEng, and together with the helper‚Äôs
<code class="inline-code">THREAD_ALL_ACCESS</code> handles and matching timestamps this ties
the launcher ‚Üí helper ‚Üí suspended-thread sequence to the 50s freeze.</p>
<h2 id="source-code-correlation">Source-code correlation</h2>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>cmd <span class="op">&lt;&lt;</span> werPath <span class="op">&lt;&lt;</span> <span class="st">L&quot; /h&quot;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span> <span class="st">L&quot; /pid &quot;</span> <span class="op">&lt;&lt;</span> targetPID</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span> <span class="st">L&quot; /tid &quot;</span> <span class="op">&lt;&lt;</span> targetTID</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span> <span class="st">L&quot; /encfile &quot;</span> <span class="op">&lt;&lt;</span> HandleToDecimal<span class="op">(</span>hEncDump<span class="op">)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span> <span class="st">L&quot; /cancel &quot;</span> <span class="op">&lt;&lt;</span> HandleToDecimal<span class="op">(</span>hCancel<span class="op">)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;&lt;</span> <span class="st">L&quot; /type 268310&quot;</span><span class="op">;</span></span></code></pre></div>
<p>This block constructs the exact command-line string that appears in
the <code class="inline-code">windows.cmdline</code> plugin output - including
<code class="inline-code">/pid</code>, <code class="inline-code">/tid</code>, <code class="inline-code">/encfile</code>,
<code class="inline-code">/cancel</code>, and <code class="inline-code">/type</code>. This snippet is the
<strong>explicit reason</strong> why the helper process appeared with
that exact command line in memory, fully corroborating the runtime
evidence.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. Create the output files for the dumps</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>wstring<span class="op"> </span>dumpFileName <span class="op">=</span> <span class="st">L&quot;dump_&quot;</span> <span class="op">+</span> <span class="bu">std::</span>to_wstring<span class="op">(</span>targetPID<span class="op">)</span> <span class="op">+</span> <span class="st">L&quot;.txt&quot;</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    HANDLE hEncDump <span class="op">=</span> CreateFileW<span class="op">(</span>dumpFileName<span class="op">.</span>c_str<span class="op">(),</span> GENERIC_WRITE<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="op">&amp;</span>sa<span class="op">,</span> CREATE_ALWAYS<span class="op">,</span> FILE_ATTRIBUTE_NORMAL<span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>hEncDump <span class="op">==</span> INVALID_HANDLE_VALUE<span class="op">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcerr<span class="op"> &lt;&lt;</span> <span class="st">L&quot;Failed to create dump files: &quot;</span> <span class="op">&lt;&lt;</span> GetLastError<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. Create the cancellation event</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    HANDLE hCancel <span class="op">=</span> CreateEventW<span class="op">(&amp;</span>sa<span class="op">,</span> <span class="kw">TRUE</span><span class="op">,</span> <span class="kw">FALSE</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>hCancel<span class="op">)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcerr<span class="op"> &lt;&lt;</span> <span class="st">L&quot;Failed to create cancel event: &quot;</span> <span class="op">&lt;&lt;</span> GetLastError<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        CloseHandle<span class="op">(</span>hEncDump<span class="op">);</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>

<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    CloseHandle<span class="op">(</span>hThread<span class="op">);</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">delete</span> params<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    CloseHandle<span class="op">(</span>hEncDump<span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    CloseHandle<span class="op">(</span>hCancel<span class="op">);</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Delete the useless enc file</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>DeleteFileW<span class="op">(</span><span class="st">L&quot;t.txt&quot;</span><span class="op">))</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>wcout<span class="op"> &lt;&lt;</span> <span class="st">L&quot;File deleted successfully.&quot;</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>These code blocks explain the origin of the temporary
<code class="inline-code">t.txt</code> file we observed. The <code class="inline-code">CreateFileW()</code> call
creates a writable dump file (<code class="inline-code">dump_&lt;PID&gt;.txt</code>), and
<code class="inline-code">CreateEventW()</code> sets up a cancellation handle - both passed
to <code class="inline-code">WerFaultSecure.exe</code>. Even though the file is later
deleted, it <strong>is written to disk during execution</strong>, which
directly explains the transient file artifact captured in memory and
Process Explorer.</p>
<h2 id="detecting-edr-freeze_1.0-ttps-using-yara">Detecting EDR-Freeze_1.0 TTPs using YARA</h2>
<p>With the evidence and source code in mind, I attempted to create YARA
rules that will catch the binary itself and it‚Äôs evidence in memory. I
will state that my experience with YARA and code analysis in general is
limited, so take this as a ‚Äòbest effort‚Äô and expect false positives.</p>
<p>Firstly, a YARA rule aimed at detecting the binary itself or binaries
utilizing the same TTPs:</p>
<pre class="yara"><code class="inline-code">import &quot;pe&quot;

rule CAP_WerFaultSecure_Freeze_Technique
{
  meta:
    description = &quot;Detects binaries implementing the WER freeze technique via WerFaultSecure + MiniDumpWriteDump + privilege escalation + handle manipulation&quot;
    author = &quot;Itamar Hallstrom&quot;
    date = &quot;2025-09-26&quot;
    confidence = &quot;high&quot;
    mitre_technique = &quot;T1562.001&quot;

  strings:
    // CLI flags observed in runtime invocation of WerFaultSecure.exe
    $wer        = &quot;WerFaultSecure.exe&quot; ascii wide nocase
    $flag_pid   = &quot;/pid &quot; ascii wide
    $flag_tid   = &quot;/tid &quot; ascii wide
    $flag_enc   = &quot;/encfile &quot; ascii wide
    $flag_can   = &quot;/cancel &quot; ascii wide
    $flag_h     = &quot; /h&quot; ascii wide
    $flag_type  = &quot;/type &quot; ascii wide   // present in runtime CLI - optional but strong indicator

    // Indicators of dump file artifact behavior
    $dumpfile   = &quot;dump_&quot; ascii wide
    $tfile      = &quot;t.txt&quot; ascii wide

    // Core TTP: MiniDumpWriteDump + suspension primitives
    $mini       = &quot;MiniDumpWriteDump&quot; ascii wide nocase
    $ntsp       = &quot;NtSuspendProcess&quot; ascii wide nocase
    $zwsp       = &quot;ZwSuspendProcess&quot; ascii wide nocase
    $ntst       = &quot;NtSuspendThread&quot; ascii wide nocase
    $zwst       = &quot;ZwSuspendThread&quot; ascii wide nocase

  condition:
    // Must reference WerFaultSecure or MiniDumpWriteDump (core elements of the technique)
    ( $wer or $mini )

    // Must include at least 2 core CLI flags (with /type allowed but not required)
    and 2 of ($flag_enc, $flag_can, $flag_pid, $flag_tid, $flag_h, $flag_type)

    // Must show file + event handle creation typical of this technique
    and pe.imports(&quot;KERNEL32.dll&quot;, &quot;CreateFileW&quot;)
    and pe.imports(&quot;KERNEL32.dll&quot;, &quot;CreateEventW&quot;)

    // Must attempt privilege escalation or thread suspension
    and (
         ( pe.imports(&quot;ADVAPI32.dll&quot;, &quot;AdjustTokenPrivileges&quot;)
           and pe.imports(&quot;ADVAPI32.dll&quot;, &quot;LookupPrivilegeValueW&quot;)
           and pe.imports(&quot;ADVAPI32.dll&quot;, &quot;OpenProcessToken&quot;) )
         or any of ($ntsp, $zwsp, $ntst, $zwst)
        )

    // Require presence of dump-related artifacts (filename patterns)
    and any of ($dumpfile, $tfile)
}</code></pre>
<pre><code>python3 vol.py -r pretty -f /mnt/c/MemoryDumps/win11defender.raw windows.vadyarascan.VadYaraScan --yara-file /mnt/c/MemoryDumps/CAP_WerFaultSecure_Freeze_Technique_v2.yar</code></pre>
<figure class="figure">
<img src="./assets/YARA binary.png" alt="YARA binary">
<figcaption>
YARA binary
</figcaption>
</figure>
<p>We have a match with the first Yara rule.</p>
<p>Second YARA rule - isn‚Äôt strict binary matching but rather behavioral
clustering:</p>
<pre class="yara"><code class="inline-code">import &quot;pe&quot;

rule BEHAVIOR_ProcessFreeze_Technique_v2
{
  meta:
    description = &quot;Detects memory-resident indicators of process freezing/suspension techniques (WER, MiniDump abuse, or custom tooling)&quot;
    author = &quot;Itamar Hallstrom&quot;
    date = &quot;2025-09-26&quot;
    confidence = &quot;medium&quot;
    mitre_technique = &quot;T1562.001 - Impair Defenses&quot;

  strings:
    // CLI flags frequently observed in freeze/dump tools
    $pid      = &quot;/pid &quot; ascii wide
    $tid      = &quot;/tid &quot; ascii wide
    $encfile  = &quot;/encfile &quot; ascii wide
    $cancel   = &quot;/cancel &quot; ascii wide
    $type     = &quot;/type &quot; ascii wide

    // Privilege escalation primitives
    $adjust   = &quot;AdjustTokenPrivileges&quot; ascii wide nocase
    $lookup   = &quot;LookupPrivilegeValue&quot; ascii wide nocase
    $openproc = &quot;OpenProcessToken&quot; ascii wide nocase
    $sedebug  = &quot;SeDebugPrivilege&quot; ascii wide nocase

    // Core process/thread manipulation APIs
    $ntsp     = &quot;NtSuspendProcess&quot; ascii wide nocase
    $zwsp     = &quot;ZwSuspendProcess&quot; ascii wide nocase
    $ntst     = &quot;NtSuspendThread&quot; ascii wide nocase
    $zwst     = &quot;ZwSuspendThread&quot; ascii wide nocase
    $term     = &quot;TerminateProcess&quot; ascii wide nocase
    $crt      = &quot;CreateRemoteThread&quot; ascii wide nocase
    $ct       = &quot;CreateThread&quot; ascii wide nocase

    // Handle plumbing and synchronization primitives
    $evt      = &quot;CreateEventW&quot; ascii wide nocase
    $cfile    = &quot;CreateFileW&quot; ascii wide nocase
    $dump     = &quot;MiniDumpWriteDump&quot; ascii wide nocase
    $tfile    = &quot;t.txt&quot; ascii wide

  condition:
    // --- Privilege Escalation ---
    2 of ($adjust, $lookup, $openproc, $sedebug)

    // --- Process/thread manipulation ---
    and 2 of ($ntsp, $zwsp, $ntst, $zwst, $term, $crt, $ct)

    // --- Command-line patterns typical of suspend/dump tools ---
    and 2 of ($pid, $tid, $encfile, $cancel, $type)

    // --- Evidence of dump handle / file I/O behavior ---
    and any of ($evt, $cfile, $dump, $tfile)
}
</code></pre>
<pre><code>python3 vol.py -r pretty -f /mnt/c/MemoryDumps/cleanwin11defender.raw windows.vadyarascan.VadYaraScan --yara-file /mnt/c/MemoryDumps/BEHAVIOR_ProcessFreeze_Technique_v2.yar</code></pre>
<figure class="figure">
<img src="./assets/YARA B1.png" alt="YARA B1">
<figcaption>
YARA B1
</figcaption>
</figure>
<figure class="figure">
<img src="./assets/YARA B2.png" alt="YARA B2">
<figcaption>
YARA B2
</figcaption>
</figure>
<figure class="figure">
<img src="./assets/YARA B3.png" alt="YARA B3">
<figcaption>
YARA B3
</figcaption>
</figure>
<p>The snippets show that the rule catches 3 processes,
<code class="inline-code">MsMpEng.exe</code>, <code class="inline-code">WerFaultSecure.exe</code> and
<code class="inline-code">EDR-Freeze_1.0</code></p>
<p>Whereas if we run the same rule against a clean image (but one that
still contains the <code class="inline-code">EDR-Freeze_1.0</code> binary itself) - there
are no hits:</p>
<pre><code>python3 vol.py -r pretty -f /mnt/c/MemoryDumps/cleanwin11defender2.raw windows.vadyarascan.VadYaraScan --yara-file /mnt/c/MemoryDumps/BEHAVIOR_ProcessFreeze_Technique_v2.yar</code></pre>
<figure class="figure">
<img src="./assets/YARA Clean image.png" alt="YARA Clean image">
<figcaption>
YARA Clean image
</figcaption>
</figure>
<h2
id="closing-thoughts---why-this-technique-matters-beyond-the-poc">Closing
Thoughts - Why This Technique Matters Beyond the PoC</h2>
<p>This investigation shows that <strong>EDR-Freeze is far more than a
simple proof-of-concept</strong> - it demonstrates how legitimate,
signed Windows binaries (<code class="inline-code">WerFaultSecure.exe</code>,
<code class="inline-code">dbghelp.dll</code>) and standard APIs
(<code class="inline-code">MiniDumpWriteDump</code>, <code class="inline-code">NtSuspendThread</code>) can be
<strong>weaponized to silently impair security tooling without requiring
kernel-mode exploits or BYOVD drivers</strong>.</p>
<p>We validated this across multiple layers:</p>
<ul>
<li><p><strong>Behavioral telemetry:</strong> Process Explorer and
thread enumeration confirmed the deliberate suspension of
<code class="inline-code">MsMpEng.exe</code>, while temporal alignment of thread timestamps
and command-line arguments linked the launcher, helper, and target into
a single chain of activity.</p></li>
<li><p><strong>Forensic artifacts:</strong> Handle tables, IAT entries,
and transient file creation (<code class="inline-code">t.txt</code>) revealed the internal
mechanics of the freeze - from thread handle acquisition to dump-related
file operations - even though the process later resumed
normally.</p></li>
<li><p><strong>Source-code correlation:</strong> The PoC‚Äôs own
implementation directly explains every major artifact observed in
memory, including the command-line structure, temporary file behavior,
and suspension logic.</p></li>
<li><p><strong>Detection opportunities:</strong> Our YARA rules show
that this activity can be caught both at the binary level (static TTP
indicators) and in live memory (behavioral clustering), even when the
underlying binary is a trusted OS component.</p></li>
</ul>
<p>The bigger takeaway is that <strong>attackers don‚Äôt always need to
kill or disable EDR outright</strong> - sometimes, putting it into a
reversible ‚Äúcoma‚Äù is enough to bypass visibility during critical phases
of an operation. Detecting and investigating such techniques requires
defenders to go beyond logs and endpoint alerts, and to treat
<strong>memory acquisition, forensic analysis, and behavioral hunting as
first-class components</strong> of their incident response workflow.</p>
<p>Finally, although this proof-of-concept is relatively simple in its
design, it highlights a critical point: <strong>PPL-protected processes
- long considered a defensive barrier - can themselves be co-opted and
leveraged for malicious purposes.</strong> As attackers continue to
experiment with abusing trusted system components rather than bypassing
them outright, it will be fascinating - and vital - to watch how these
techniques evolve over time and how defensive strategies must adapt in
response.</p>

</div>
<footer>
  <p>&copy; 2025 Tracepoint ‚Äî Created by Itamar H√§llstr√∂m</p>
  <div class="social-links" style="margin-top: 1rem;">
    <a href="https://github.com/itamarhall" target="_blank" rel="noopener" style="margin: 0 1rem;">GitHub</a>
    <a href="https://www.linkedin.com/in/itamarhallstr/" target="_blank" rel="noopener" style="margin: 0 1rem;">LinkedIn</a>
    <a href="mailto:itamarhallstr@gmail.com" style="margin: 0 1rem;">Email</a>
  </div>
</footer>
</div>
<div id="lightbox" class="lightbox" aria-hidden="true">
  <button class="btn close" aria-label="Close">√ó</button>
  <button class="btn prev" aria-label="Previous">‚ùÆ</button>
  <img id="lb-img" alt="">
  <div id="lb-cap" class="caption"></div>
  <button class="btn next" aria-label="Next">‚ùØ</button>
</div>
<script>

(() => {
  const figs = Array.from(document.querySelectorAll('.figure'));
  const imgs = figs.map(f => f.querySelector('img')).filter(Boolean);
  const lb   = document.getElementById('lightbox');
  const lbi  = document.getElementById('lb-img');
  const lbc  = document.getElementById('lb-cap');
  const btnPrev = lb.querySelector('.prev');
  const btnNext = lb.querySelector('.next');
  const btnClose= lb.querySelector('.close');
  let i = 0;
  const show = (idx) => {
    i = (idx + imgs.length) % imgs.length;
    const img = imgs[i];
    lbi.src = img.dataset.full || img.src;
    lbi.alt = img.alt || '';
    const capEl = figs[i].querySelector('figcaption');
    lbc.textContent = capEl ? capEl.textContent : '';
    lb.classList.add('show');
    lb.setAttribute('aria-hidden','false');
  };
  const close = () => {
    lb.classList.remove('show');
    lb.setAttribute('aria-hidden','true');
    setTimeout(() => { lbi.removeAttribute('src'); }, 200);
  };
  imgs.forEach((img, idx) => {
    img.addEventListener('click', () => show(idx));
  });
  btnPrev.addEventListener('click', (e) => { e.stopPropagation(); show(i-1); });
  btnNext.addEventListener('click', (e) => { e.stopPropagation(); show(i+1); });
  btnClose.addEventListener('click', (e) => { e.stopPropagation(); close(); });
  lb.addEventListener('click', (e) => { if (e.target === lb) close(); });
  window.addEventListener('keydown', (e) => {
    if (!lb.classList.contains('show')) return;
    if (e.key === 'Escape') close();
    if (e.key === 'ArrowRight') show(i+1);
    if (e.key === 'ArrowLeft')  show(i-1);
  });
})();



</script>
<script src="../../../js/main.js"></script>
</body>
</html>
